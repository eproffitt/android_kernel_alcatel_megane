#include <mach/mt_typedefs.h>

#define FGAUGE_VOLTAGE_FACTOR           2.44 // mV
#define FGAUGE_CURRENT_FACTOR           6.25 // uV/Rsns
#define FGAUGE_CURRENT_OFFSET_FACTOR    1.56 // uV/Rsns
#define FGAUGE_CAR_FACTOR               6.25 // uV/Rsns
#define FGAUGE_RSNS_FACTOR              0.02 // Ohm

//#define COMPASATE_OCV                   80 // mV for evb
#define COMPASATE_OCV                   40 // mV for phone

#define BATTERY_VOLTAGE_MINIMUM         3400
#define BATTERY_VOLTAGE_MAXIMUM         4200

#define BATTERY_CAPACITY_MAXIMUM        1142 //pcyang modified

#define TEMPERATURE_T0                  110
#define TEMPERATURE_T1                  0
#define TEMPERATURE_T2                  25
#define TEMPERATURE_T3                  50
#define TEMPERATURE_T                   255 // This should be fixed, never change the value

//#define BATT_CAPACITY                   1280
#define BATT_CAPACITY                   1277 //pcyang modified

#define ENABLE_SW_COULOMB_COUNTER       0 // 1 is enable, 0 is disable
//#define ENABLE_SW_COULOMB_COUNTER       1 // 1 is enable, 0 is disable

//#define FG_CURRENT_OFFSET_DISCHARGING 	31
#define FG_CURRENT_OFFSET_DISCHARGING 	0

#define FG_RESISTANCE 	20

#define FG_METER_RESISTANCE 	0
//#define FG_METER_RESISTANCE 	540 // current meter

//#define MAX_BOOTING_TIME_FGCURRENT	5*6 // 5 seconds, 6 points = 1s
#define MAX_BOOTING_TIME_FGCURRENT	1*10 // 10s

#if defined(CONFIG_POWER_EXT)
//#define OCV_BOARD_COMPESATE	32 //mV 
#define OCV_BOARD_COMPESATE	72 //mV 
#define R_FG_BOARD_BASE		1000
#define R_FG_BOARD_SLOPE	1000 //slope
#else
//#define OCV_BOARD_COMPESATE	0 //mV 
//#define OCV_BOARD_COMPESATE	48 //mV 
//#define OCV_BOARD_COMPESATE	25 //mV 
#define OCV_BOARD_COMPESATE	0 //mV 
#define R_FG_BOARD_BASE		1000
#define R_FG_BOARD_SLOPE	1000 //slope
//#define R_FG_BOARD_SLOPE	1057 //slope
//#define R_FG_BOARD_SLOPE	1075 //slope
#endif

#define Q_MAX_POS_50	1142 //pcyang modified
#define Q_MAX_POS_25	1277 //pcyang modified
#define Q_MAX_POS_0	1124	//pcyang modified
#define Q_MAX_NEG_10	604	//pcyang modified

#define Q_MAX_POS_50_H_CURRENT	1131	//pcyang modified
#define Q_MAX_POS_25_H_CURRENT	1261	//pcyang modified
#define Q_MAX_POS_0_H_CURRENT	778	//pcyang modified
#define Q_MAX_NEG_10_H_CURRENT	408	//pcyang modified

#define R_FG_VALUE 				20 // mOhm, base is 20
#define CURRENT_DETECT_R_FG	100  //10mA

#define OSR_SELECT_7			0

#define CAR_TUNE_VALUE			91 //1.00

/////////////////////////////////////////////////////////////////////
// <DOD, Battery_Voltage> Table
/////////////////////////////////////////////////////////////////////
typedef struct _BATTERY_PROFILE_STRUC
{
    kal_int32 percentage;
    kal_int32 voltage;
} BATTERY_PROFILE_STRUC, *BATTERY_PROFILE_STRUC_P;

typedef enum
{
    T1_0C,
    T2_25C,
    T3_50C
} PROFILE_TEMPERATURE;

// T0 -10C
BATTERY_PROFILE_STRUC battery_profile_t0[] =
{
{0 , 4156},
{3 , 4134},
{7 , 4115},
{10 , 4099},
{13 , 4085},
{17 , 4073},
{20 , 4063},
{23 , 4053},
{26 , 4044},
{30 , 4035},
{33 , 4026},
{36 , 4019},
{40 , 4010},
{43 , 4002},
{46 , 3995},
{50 , 3987},
{53 , 3981},
{56 , 3973},
{59 , 3965},
{63 , 3954},
{66 , 3935},
{69 , 3891},
{72 , 3843},
{73 , 3835},
{74 , 3831},
{75 , 3827},
{76 , 3825},
{77 , 3822},
{78 , 3821},
{79 , 3820},
{80 , 3817},
{81 , 3816},
{81 , 3814},
{82 , 3814},
{83 , 3812},
{83 , 3811},
{84 , 3810},
{85 , 3809},
{85 , 3808},
{86 , 3807},
{87 , 3807},
{87 , 3806},
{88 , 3805},
{88 , 3804},
{89 , 3804},
{89 , 3803},
{90 , 3802},
{90 , 3801},
{91 , 3801},
{91 , 3800},
{92 , 3800},
{92 , 3799},
{92 , 3798},
{93 , 3798},
{93 , 3797},
{94 , 3797},
{94 , 3796},
{95 , 3795},
{95 , 3795},
{95 , 3794},
{96 , 3794},
{96 , 3793},
{96 , 3793},
{97 , 3793},
{97 , 3792},
{97 , 3791},
{98 , 3791},
{98 , 3790},
{98 , 3790},
{99 , 3789},
{99 , 3789},
{99 , 3788},
{99 , 3788},
{100 , 3787},
{100 , 3787},
{100 , 3400}
};      
        
// T1 0C
BATTERY_PROFILE_STRUC battery_profile_t1[] =
{
{0, 4173},
{2, 4157},
{4, 4142},
{5, 4127},
{7, 4112},
{9, 4099},
{11, 4086},
{12, 4074},
{14, 4063},
{16, 4051},
{18, 4033},
{20, 4008},
{21, 3973},
{23, 3950},
{25, 3936},
{27, 3925},
{28, 3914},
{30, 3903},
{32, 3891},
{34, 3879},
{35, 3867},
{37, 3855},
{39, 3845},
{41, 3837},
{43, 3831},
{44, 3824},
{46, 3820},
{48, 3814},
{50, 3810},
{52, 3806},
{53, 3802},
{55, 3799},
{57, 3795},
{59, 3791},
{60, 3789},
{62, 3786},
{64, 3782},
{66, 3781},
{67, 3778},
{69, 3775},
{71, 3772},
{73, 3768},
{75, 3763},
{76, 3758},
{78, 3751},
{80, 3742},
{82, 3733},
{83, 3720},
{85, 3710},
{87, 3703},
{89, 3698},
{91, 3694},
{92, 3690},
{94, 3682},
{96, 3670},
{97, 3658},
{97, 3646},
{98, 3631},
{98, 3619},
{99, 3607},
{99, 3598},
{99, 3591},
{99, 3584},
{99, 3579},
{100, 3575},
{100, 3572},
{100, 3569},
{100, 3566},
{100, 3563},
{100, 3560},
{100, 3559},
{100, 3558},
{100, 3556},
{100, 3554},
{100, 3552},
{100, 3400}
};

// T2 25C
BATTERY_PROFILE_STRUC battery_profile_t2[] =
{
{0, 4173},
{2, 4155},
{3, 4140},
{5, 4126},
{6, 4113},
{8, 4100},
{9, 4087},
{11, 4075},
{13, 4063},
{14, 4051},
{16, 4039},
{17, 4026},
{19, 4015},
{20, 4005},
{22, 3994},
{23, 3985},
{25, 3976},
{27, 3967},
{28, 3958},
{30, 3949},
{31, 3941},
{33, 3930},
{34, 3920},
{36, 3907},
{38, 3892},
{39, 3878},
{41, 3866},
{42, 3857},
{44, 3849},
{45, 3843},
{47, 3836},
{48, 3832},
{50, 3825},
{52, 3821},
{53, 3817},
{55, 3812},
{56, 3807},
{58, 3804},
{59, 3800},
{61, 3797},
{62, 3794},
{64, 3789},
{66, 3787},
{67, 3783},
{69, 3780},
{70, 3776},
{72, 3773},
{73, 3768},
{75, 3763},
{77, 3757},
{78, 3751},
{80, 3744},
{81, 3735},
{83, 3723},
{84, 3713},
{86, 3698},
{88, 3692},
{89, 3691},
{91, 3690},
{92, 3689},
{94, 3686},
{95, 3676},
{97, 3622},
{98, 3538},
{100, 3401},
{100, 3319},
{100, 3302},
{100, 3296},
{100, 3293},
{100, 3293},
{100, 3291},
{100, 3290},
{100, 3291},
{100, 3292},
{100, 3292},
{100, 3292}
}; 

// T3 50C
BATTERY_PROFILE_STRUC battery_profile_t3[] =
{
{0, 4190},
{2, 4174},
{4, 4159},
{5, 4145},
{7, 4131},
{9, 4117},
{11, 4105},
{12, 4091},
{14, 4079},
{16, 4067},
{18, 4054},
{19, 4042},
{21, 4031},
{23, 4019},
{24, 4008},
{26, 3996},
{28, 3982},
{30, 3967},
{31, 3951},
{33, 3936},
{35, 3923},
{37, 3912},
{38, 3903},
{40, 3894},
{42, 3885},
{44, 3877},
{45, 3870},
{47, 3863},
{49, 3857},
{51, 3850},
{52, 3843},
{54, 3838},
{56, 3832},
{58, 3826},
{59, 3820},
{61, 3815},
{63, 3807},
{65, 3799},
{66, 3791},
{68, 3783},
{70, 3776},
{72, 3767},
{73, 3760},
{75, 3752},
{77, 3744},
{79, 3735},
{80, 3723},
{82, 3711},
{84, 3695},
{86, 3688},
{87, 3683},
{89, 3681},
{91, 3679},
{93, 3676},
{94, 3670},
{96, 3626},
{98, 3552},
{100, 3438},
{100, 3288},
{100, 3272},
{100, 3267},
{100, 3262},
{100, 3261},
{100, 3260},
{100, 3260},
{100, 3259},
{100, 3258},
{100, 3256},
{100, 3256},
{100, 3256},
{100, 3258},
{100, 3257},
{100, 3256},
{100, 3256},
{100, 3256},
{100, 3256}
};              

// battery profile for actual temperature. The size should be the same as T1, T2 and T3
BATTERY_PROFILE_STRUC battery_profile_temperature[] =
{
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0}
};    

/////////////////////////////////////////////////////////////////////
// <Rbat, Battery_Voltage> Table
/////////////////////////////////////////////////////////////////////
typedef struct _R_PROFILE_STRUC
{
    kal_int32 resistance; // Ohm
    kal_int32 voltage;
} R_PROFILE_STRUC, *R_PROFILE_STRUC_P;

// T0 -10C
R_PROFILE_STRUC r_profile_t0[] =
{
{1018, 4156},
{643, 4134},
{665, 4115},
{688, 4099},
{698, 4085},
{703, 4073},
{715, 4063},
{725, 4053},
{723, 4044},
{723, 4035},
{733, 4026},
{735, 4019},
{740, 4010},
{745, 4002},
{758, 3995},
{765, 3987},
{775, 3981},
{798, 3973},
{838, 3965},
{928, 3954},
{1138, 3935},
{1495, 3891},
{1608, 3843},
{1588, 3835},
{1578, 3831},
{1570, 3827},
{1563, 3825},
{1555, 3822},
{1555, 3821},
{1550, 3820},
{1543, 3817},
{1540, 3816},
{1538, 3814},
{1535, 3814},
{1530, 3812},
{1530, 3811},
{1525, 3810},
{1523, 3809},
{1523, 3808},
{1518, 3807},
{1520, 3807},
{1515, 3806},
{1513, 3805},
{1513, 3804},
{1510, 3804},
{1508, 3803},
{1505, 3802},
{1503, 3801},
{1505, 3801},
{1500, 3800},
{1503, 3800},
{1498, 3799},
{1498, 3798},
{1498, 3798},
{1493, 3797},
{1493, 3797},
{1490, 3796},
{1490, 3795},
{1490, 3795},
{1485, 3794},
{1485, 3794},
{1485, 3793},
{1488, 3793},
{1488, 3793},
{1483, 3792},
{1478, 3791},
{1478, 3791},
{1480, 3790},
{1478, 3790},
{1473, 3789},
{1475, 3789},
{1473, 3788},
{1473, 3788},
{1470, 3787},
{1473, 3787},
{500, 3400}
};

// T1 0C
R_PROFILE_STRUC r_profile_t1[] =
{
{573, 4173},
{325, 4157},
{340, 4142},
{348, 4127},
{350, 4112},
{353, 4099},
{358, 4086},
{365, 4074},
{373, 4063},
{393, 4051},
{435, 4033},
{528, 4008},
{668, 3973},
{823, 3950},
{853, 3936},
{865, 3925},
{873, 3914},
{883, 3903},
{878, 3891},
{875, 3879},
{870, 3867},
{863, 3855},
{858, 3845},
{858, 3837},
{870, 3831},
{865, 3824},
{870, 3820},
{878, 3814},
{880, 3810},
{883, 3806},
{890, 3802},
{893, 3799},
{900, 3795},
{908, 3791},
{915, 3789},
{918, 3786},
{920, 3782},
{930, 3781},
{928, 3778},
{935, 3775},
{938, 3772},
{943, 3768},
{945, 3763},
{958, 3758},
{958, 3751},
{965, 3742},
{973, 3733},
{978, 3720},
{988, 3710},
{1005, 3703},
{1023, 3698},
{1055, 3694},
{1103, 3690},
{1145, 3682},
{1178, 3670},
{1148, 3658},
{1120, 3646},
{1080, 3631},
{1053, 3619},
{1020, 3607},
{995, 3598},
{983, 3591},
{968, 3584},
{950, 3579},
{940, 3575},
{933, 3572},
{928, 3569},
{920, 3566},
{913, 3563},
{908, 3560},
{903, 3559},
{900, 3558},
{7000, 3556},
{8000, 3554},
{9000, 3552},
{10000, 3400}
}; 

// T2 25C
R_PROFILE_STRUC r_profile_t2[] =
{
{225, 4173},
{275, 4155},
{278, 4140},
{283, 4126},
{285, 4113},
{288, 4100},
{288, 4087},
{288, 4075},
{288, 4063},
{288, 4051},
{295, 4039},
{298, 4026},
{303, 4015},
{310, 4005},
{313, 3994},
{318, 3985},
{325, 3976},
{330, 3967},
{335, 3958},
{338, 3949},
{345, 3941},
{340, 3930},
{340, 3920},
{330, 3907},
{315, 3892},
{300, 3878},
{293, 3866},
{288, 3857},
{283, 3849},
{283, 3843},
{280, 3836},
{283, 3832},
{280, 3825},
{275, 3821},
{273, 3817},
{265, 3812},
{263, 3807},
{263, 3804},
{263, 3800},
{263, 3797},
{263, 3794},
{258, 3789},
{258, 3787},
{253, 3783},
{253, 3780},
{253, 3776},
{258, 3773},
{253, 3768},
{253, 3763},
{250, 3757},
{248, 3751},
{245, 3744},
{245, 3735},
{245, 3723},
{248, 3713},
{243, 3698},
{240, 3692},
{243, 3691},
{245, 3690},
{253, 3689},
{260, 3686},
{275, 3676},
{260, 3622},
{275, 3538},
{298, 3401},
{300, 3319},
{258, 3302},
{243, 3296},
{243, 3293},
{235, 3293},
{238, 3291},
{238, 3290},
{228, 3291},
{233, 3292},
{248, 3292},
{245, 3292}
}; 

// T3 50C
R_PROFILE_STRUC r_profile_t3[] =
{
{143, 4190},
{148, 4174},
{150, 4159},
{153, 4145},
{155, 4131},
{155, 4117},
{158, 4105},
{153, 4091},
{160, 4079},
{163, 4067},
{163, 4054},
{163, 4042},
{168, 4031},
{170, 4019},
{175, 4008},
{183, 3996},
{183, 3982},
{183, 3967},
{175, 3951},
{170, 3936},
{163, 3923},
{160, 3912},
{160, 3903},
{160, 3894},
{158, 3885},
{158, 3877},
{160, 3870},
{160, 3863},
{165, 3857},
{165, 3850},
{160, 3843},
{168, 3838},
{165, 3832},
{168, 3826},
{168, 3820},
{170, 3815},
{165, 3807},
{165, 3799},
{163, 3791},
{163, 3783},
{163, 3776},
{158, 3767},
{163, 3760},
{160, 3752},
{160, 3744},
{160, 3735},
{160, 3723},
{160, 3711},
{155, 3695},
{163, 3688},
{158, 3683},
{160, 3681},
{163, 3679},
{168, 3676},
{180, 3670},
{170, 3626},
{175, 3552},
{185, 3438},
{225, 3288},
{183, 3272},
{173, 3267},
{160, 3262},
{158, 3261},
{155, 3260},
{150, 3260},
{155, 3259},
{150, 3258},
{148, 3256},
{148, 3256},
{145, 3256},
{148, 3258},
{143, 3257},
{143, 3256},
{143, 3256},
{143, 3256},
{148, 3256}
}; 

// r-table profile for actual temperature. The size should be the same as T1, T2 and T3
R_PROFILE_STRUC r_profile_temperature[] =
{
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},   
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0},
    {0, 0}
};     


int fgauge_get_saddles(void);
BATTERY_PROFILE_STRUC_P fgauge_get_profile(kal_uint32 temperature);

int fgauge_get_saddles_r_table(void);
R_PROFILE_STRUC_P fgauge_get_profile_r_table(kal_uint32 temperature);

